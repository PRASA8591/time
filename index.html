<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Working Hours Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      margin: 20px;
      background: linear-gradient(135deg, #f9f9f9, #e0f7fa);
    }
    h2 {
      text-align: center;
      color: #00796b;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      border-radius: 8px;
      overflow: hidden;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #00796b;
      color: white;
    }
    tfoot td {
      font-weight: bold;
      background: #b2dfdb;
    }
    input {
      padding: 5px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 14px;
      width: 100%;
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      background: #00796b;
      color: white;
      cursor: pointer;
    }
    button:hover { background: #004d40; }
    @media (max-width: 768px) {
      table, thead, tbody, th, td, tr { display: block; }
      tr { margin-bottom: 15px; }
      td, th { text-align: right; padding-left: 50%; position: relative; }
      td::before, th::before {
        content: attr(data-label);
        position: absolute;
        left: 10px;
        width: 45%;
        text-align: left;
        font-weight: bold;
      }
    }
  </style>
</head>
<body>
  <h2>Monthly Working Hours Tracker</h2>
  
  <table id="hoursTable">
    <thead>
      <tr>
        <th>Day</th>
        <th>Start Date</th>
        <th>Start Time</th>
        <th>End Date</th>
        <th>End Time</th>
        <th>Total (hh:mm)</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
    <tfoot>
      <tr>
        <td colspan="5">Total Hours</td>
        <td id="monthTotal">00:00</td>
      </tr>
    </tfoot>
  </table>

  <div style="text-align:center;">
    <button onclick="saveToFirebase()">ðŸ’¾ Save Data</button>
    <button onclick="loadFromFirebase()">ðŸ”„ Reload Data</button>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    // âœ… Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBJHqn-KIG7ntbsc9OZik7hf5lhObx7Ecg",
      authDomain: "hours-80ce8.firebaseapp.com",
      projectId: "hours-80ce8",
      storageBucket: "hours-80ce8.appspot.com",
      messagingSenderId: "425460400755",
      appId: "1:425460400755:web:9fbbe205d914e8f84c2006"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const tableBody = document.getElementById("tableBody");
    const monthTotalCell = document.getElementById("monthTotal");
    const daysInMonth = 30;
    const docId = "currentMonth"; // fixed doc ID for consistent saving

    // build rows
    for (let d = 1; d <= daysInMonth; d++) {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td data-label="Day">${d}</td>
        <td data-label="Start Date"><input type="date" class="startDate"></td>
        <td data-label="Start Time"><input type="time" class="startTime"></td>
        <td data-label="End Date"><input type="date" class="endDate"></td>
        <td data-label="End Time"><input type="time" class="endTime"></td>
        <td data-label="Total" class="total">00:00</td>
      `;
      tableBody.appendChild(row);
    }

    // calculate total
    function calculateHours() {
      let totalMinutes = 0;

      [...tableBody.querySelectorAll("tr")].forEach(row => {
        const sDate = row.querySelector(".startDate").value;
        const sTime = row.querySelector(".startTime").value;
        const eDate = row.querySelector(".endDate").value;
        const eTime = row.querySelector(".endTime").value;
        const totalCell = row.querySelector(".total");

        if (sDate && sTime && eDate && eTime) {
          const start = new Date(`${sDate}T${sTime}`);
          const end = new Date(`${eDate}T${eTime}`);
          let diff = (end - start) / 60000;
          if (diff < 0) diff = 0;

          const h = Math.floor(diff / 60);
          const m = diff % 60;
          totalCell.textContent = `${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}`;
          totalMinutes += diff;
        } else {
          totalCell.textContent = "00:00";
        }
      });

      const H = Math.floor(totalMinutes / 60);
      const M = totalMinutes % 60;
      monthTotalCell.textContent = `${String(H).padStart(2,"0")}:${String(M).padStart(2,"0")}`;
    }

    tableBody.addEventListener("input", calculateHours);

    // save
    function saveToFirebase() {
      let records = [];
      [...tableBody.querySelectorAll("tr")].forEach((row, i) => {
        records.push({
          day: i + 1,
          startDate: row.querySelector(".startDate").value,
          startTime: row.querySelector(".startTime").value,
          endDate: row.querySelector(".endDate").value,
          endTime: row.querySelector(".endTime").value,
          total: row.querySelector(".total").textContent
        });
      });

      db.collection("workingHours").doc(docId).set({
        timestamp: new Date(),
        records: records,
        monthTotal: monthTotalCell.textContent
      }).then(() => {
        alert("âœ… Data saved!");
      }).catch(err => console.error("Save error:", err));
    }

    // load
    function loadFromFirebase() {
      db.collection("workingHours").doc(docId).get().then(doc => {
        if (doc.exists) {
          const data = doc.data();
          [...tableBody.querySelectorAll("tr")].forEach((row, i) => {
            const r = data.records[i];
            if (r) {
              row.querySelector(".startDate").value = r.startDate || "";
              row.querySelector(".startTime").value = r.startTime || "";
              row.querySelector(".endDate").value = r.endDate || "";
              row.querySelector(".endTime").value = r.endTime || "";
              row.querySelector(".total").textContent = r.total || "00:00";
            }
          });
          monthTotalCell.textContent = data.monthTotal || "00:00";
        }
      });
    }

    window.onload = loadFromFirebase;
  </script>
</body>
</html>
